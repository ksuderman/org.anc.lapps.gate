#!/usr/bin/env lsd

String version = new File("VERSION").text

String ROOT = "http://grid.anc.org:9080/GateServices/$version/services"

//List ok = []
List errors = []

String serviceList = 'Tokenizer SentenceSplitter VerbPhraseChunker Coreference NounPhraseChunker Gazetteer POSTagger NamedEntityRecognizer OrthoMatcher'
serviceList.tokenize(' ').each {
    ServiceClient client = new ServiceClient("$ROOT/$it")
    println it.toUpperCase()
    Data data = Serializer.parse(client.getMetadata(), Data)
    //println groovy.json.JsonOutput.prettyPrint(client.getMetadata())
    if (Uri.ERROR == data.discriminator) {
        errors << [name:it, error:data.payload]
    }
//    else {
//        ok << it
//    }

    //println()
}
if (errors.size() > 0) {
    println "${errors.size()} components had errors"
    errors.each { m ->
        println "${m.name}: ${m.error}"
    }
}
else {
    println "All services passed."
}

