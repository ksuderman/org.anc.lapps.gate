#!/usr/bin/env lsd

String version = new File("VERSION").text

String ROOT = "http://grid.anc.org:9080/GateServices/$version/services"

Data data = new Data(Uri.TEXT, "Karen flew to New York.")
String serviceList = 'Tokenizer SentenceSplitter POSTagger NamedEntityRecognizer VerbPhraseChunker NounPhraseChunker Gazetteer OrthoMatcher'
serviceList.tokenize(' ').each {
    println "Running $it"
    ServiceClient client = new ServiceClient("$ROOT/$it")
    String json = client.execute(data.asJson())
    data = Serializer.parse(json, Data)
    //println groovy.json.JsonOutput.prettyPrint(client.getMetadata())
    if (Uri.ERROR == data.discriminator) {
        //throw new Exception("Unable to run $it")
        println "Unable to run $it"
        println data.payload
        System.exit(1)
    }

}

println "All services passed."
